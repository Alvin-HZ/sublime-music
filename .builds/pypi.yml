image: archlinux
packages:
  - python-poetry
  - xorg-server-xvfb
sources:
  - https://git.sr.ht/~sumner/offlinemsmtp
environment:
  REPO_NAME: sublime-music
# triggers:
#   - action: email
#     condition: failure
#     to: ~sumner/sublime-music-devel@lists.sr.ht
tasks:
  - setup: |
      cd ${REPO_NAME}
      poetry install
      echo "cd ${REPO_NAME}" >> ~/.buildenv
      echo "source $(poetry env info -p)/bin/activate" >> ~/.buildenv

  - build: |
      python setup.py sdist

  - deploy_pypi: |
      echo "deploy"

  - verify_pypi: |
      echo "deploy"
